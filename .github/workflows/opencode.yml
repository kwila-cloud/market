name: OpenCode

on:
  issue_comment:
    types: [created]

permissions:
  contents: write     # prevents non-writers from committing
  pull-requests: write
  issues: write

jobs:
  opencode:
    # Only run when the comment contains /oc or /opencode
    if: |
      (contains(github.event.comment.body, '/oc') ||
       contains(github.event.comment.body, '/opencode')) &&
      (
        github.event.comment.author_association == 'OWNER' ||
        github.event.comment.author_association == 'MEMBER' ||
        github.event.comment.author_association == 'COLLABORATOR'
      )

    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Run OpenCode (OpenRouter)
        uses: sst/opencode/github@latest
        env:
          OPENROUTER_API_KEY: ${{ secrets.OPENROUTER_API_KEY }}
        with:
          model: openrouter/openai/gpt-5.1-codex