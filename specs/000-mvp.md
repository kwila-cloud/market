# MVP

## Description

This document contains the basic roadmap for the minimal viable product (MVP).

## Task List

### Infrastructure & Setup

- [x] **Initialize project structure**
  - [x] Create Astro 5.x project with React 19 islands
  - [x] Add home page with basic info from README
    - [x] Basic marketing blurb
    - [x] Describe core values
    - [x] Large input at the top of the page - "What are you looking for?"
  - [x] Setup TypeScript strict mode
  - [x] Configure Tailwind CSS 4.x
  - [x] Add basic folder structure (components, layouts, lib)
  - [x] Store platform name as environment variable, so it can easily be changed in the future
  - [x] Eslint config
  - [x] Prettier config
  - [x] Add GitHub actions for
    - [x] Linting
    - [x] Type checking
    - [x] Verify formatting
  - [x] Include PWA configuration

- [x] **Basic theming system**
  - [x] Add basic system for theming from the get-go
  - [x] Implement modular theming system which makes it easy to define more themes in the future
  - [x] Save selected user theme in local storage
  - [x] Create 4 themes with distinct color palettes
    - [x] Dusk (default, dark) - Blue primary, dusk orange secondary
    - [x] Ember (dark) - Orange primary, burnt orange secondary
    - [x] Ocean (light) - Blue primary, teal secondary
    - [x] Forest (light) - Green primary, tree bark brown secondary
  - [x] Implement SSR-safe theme initialization to prevent FOUC
  - [x] Add theme selector component with visual previews
  - [x] Use CSS custom properties for easy theme switching
  - [x] Apply theme colors to navbar with gradient effects and hover accents
  - [x] Centralize theme configuration in single source of truth

- [x] **Setup testing framework**
  - [x] Configure Vitest for unit tests
  - [x] Configure Playwright for E2E tests
  - [x] Add basic test structure
  - [x] Add simple unit tests for any existing logic
  - [x] Add simple E2E test that verifies theme selector

- [x] **Setup Supabase integration**
  - [x] Init Supabase project with the CLI
  - [x] Setup Supabase preview on each pull request
  - [x] Setup GitHub workflow to configure Cloudflare preview deployments to point at the correct Supabase preview database
  - [x] Update `INFRASTRUCTURE.md` with Supabase database information

- [x] **Database migrations**
  - [x] Remove temporary Supabase test page
  - [x] Create initial declarative schemas
  - [x] Include RLS
  - [x] Use Supabase CLI to generate initial migrations

- [x] **Seed data**
  - [x] Create scripts for adding basic seed data in preview branches

- [x] **Setup Supabase storage**
  - [x] Configure local Supabase storage configuration
  - [x] Add RLS policy for avatar images (anyone can view)
  - [x] Add RLS policy for item images (matches RLS policy of item)
  - [x] Add RLS policy for message images (matches RLS policy of message)
  - [x] Add images to seed data
    - [x] Avatars
    - [x] Item images

- [x] **Setup local development environment**
  - [x] Set up scripts in `package.json` to trigger important supabase CLI commands
    - [x] Replace `dev` with `start:frontend`
    - [x] Replace `build` with `build:frontend`
    - [x] Remove `preview`
    - [x] Remove `test` (we already have `test:unit`)
    - [x] Remove `test:watch`
    - [x] Add `start:backend`
    - [x] Add `stop:backend`
  - [x] Update "Getting Started" section in `CONTRIBUTING.md`
  - [x] Update `AGENTS.md` to mention current `npm run` scripts

### Static Pages

- [x] **Content policy**
  - [x] A page describing all items that are acceptable to be listed on the market
  - [x] Include contact info for requesting more items to be added to acceptable list

- [x] **About page**
  - [x] Background info
  - [x] Link to creator of the site - https://kwila.cloud
  - [x] Contact info

### Authentication System

- [x] **Setup Supabase email auth**
  - [x] Configure Supabase project with email OTP
  - [x] Create initial user from Supabase dashboard
  - [x] Implement route protection middleware
  - [x] Add user session verification
  - [x] Implement basic login flow for existing user
    - [x] Trigger email OTP
    - [x] Verify OTP
    - [x] View basic auth-only dashboard
  - [x] Update `INFRASTRUCTURE.md` with Supabase auth information
  - [x] Redirect from `/` to `/dashboard` for signed-in users
  - [x] Associate authenticated users with our user table in DB

- [x] **Add invite codes page**
  - [x] Add dedicated page for invite code
  - [x] List status of user's invite codes
  - [x] Allow user to create new invite codes
  - [x] Use our Button component on invite page
  - [x] Add new Card component
    - [x] Include title property (always shown in h2)
    - [x] Use it on the dashboard page
    - [x] Use it in the invite manager
    - [x] Use it in the core values component
  - [x] Move "Quick Actions" to their own Card, above the "Account Information" card
  - [x] Include revoked invites in the history section
  - [x] Include clear warning about only inviting trusted people with which you have an in-person relationship
  - [x] Require the user to input invitee's name
  - [x] Save invitee's name with invite code in new column "name"
  - [x] Require the user to check a box "I have met this person in person multiple times"
  - [x] Require the user to check a box "I agree to allow this person to have access to my Contacts-Only information"
  - [x] Do not allow user to create invite code without checking both boxes and entering the invitee's name

- [ ] **Build signup flow**
  - [ ] To avoid leaking details about existing users, we will create new user for each new OTP sign up
  - [ ] Add column to users table that tracks their auth user ID (not nullable)
  - [ ] Add invite code entry page for users that have signed in but don't have a record in the users table yet
    - [ ] Prompt them to enter invite code
    - [ ] Do not allow them to view any other page in the frontend until their enter invite code
  - [ ] Update login page with appropriate warning
    - [ ] Use "Welcome" instead of "Welcome back"
    - [ ] Remove message about needing an invite code to sign up
  - [ ] We only create new record in the users table once a user has entered a valid invite code
    - [ ] We will need to remove current trigger that automatically adds records to the users table
    - [ ] Users that are not in the users table should not be allowed to create new items, threads, or connections (enforced by RLS)
  - [ ] Once user inputs valid invite code, use Supabase edge function to set things up:
    - [ ] Create user record with invited_by relationship
    - [ ] Add new accepted connection between two users
  - [ ] Build basic onboarding flow
    - [ ] Contact visibility settings
    - [ ] Display Name (default to value from invite code)
    - [ ] Bio information
    - [ ] For now - use https://www.dicebear.com/styles/initials/ to automatically generate and upload avatar for new user

- [ ] **Setup Supabase SMS auth**
  - [ ] Configure Supabase project with SMS OTP
  - [ ] Add Twilio integration for SMS auth
  - [ ] Implement basic login flow for existing user
    - [ ] Trigger SMS OTP
    - [ ] Verify OTP
    - [ ] View basic auth-only dashboard
  - [ ] Add SMS OTP to signup flow

### Core User Management

- [ ] **Implement user profile system**
  - [ ] Create user settings management
  - [ ] Add profile editing functionality
  - [ ] Save selected user theme to user settings
  - [ ] Implement vendor_id uniqueness and user profile pages

- [ ] **Build connection system**
  - [ ] Create connection requests functionality
  - [ ] Implement acceptance/decline flows
  - [ ] Add connection status tracking
  - [ ] Create connection list components

### Item Management System

- [ ] **Create category management**
  - [ ] Create category selection component
  - [ ] Add category filtering and display

- [ ] **Build item creation flow**
  - [ ] Make large input functional (search/buy request creation) on the home page
  - [ ] Create item form component
  - [ ] Implement item validation
  - [ ] Add image upload with compression
  - [ ] User must check box that new item complies with the content policy (include link)

- [ ] **Implement item listing and search**
  - [ ] Create items listing page with filters
  - [ ] Add search functionality
  - [ ] Implement item visibility rules
  - [ ] Create item detail pages
  - [ ] Implement view transition from `ItemCard` to item detail page

- [ ] **Implement watch list**
  - [ ] Allow user to save a search/filter combination for easy access in the future
  - [ ] Allow user to enable weekly notifications for any search in their watch list
  - [ ] Implement CloudFlare worker that goes through each item in the watch list for every user and send notifications that include any new items (added in the past week)

### Messaging System

- [ ] **Create messaging infrastructure**
  - [ ] Setup thread creation logic
  - [ ] Implement message sending/receiving
  - [ ] Add message realtime system
  - [ ] Create thread list interface

- [ ] **Build message images support**
  - [ ] Implement image upload for messages
  - [ ] Create message composition UI

### UI & Polish

- [ ] **Create main navigation and layouts**
  - [ ] Build header component with navigation
  - [ ] Create dashboard layout
  - [ ] Implement responsive design
  - [ ] Add custom 404 page

- [ ] **Implement item feed and vendor pages**
  - [ ] Create vendor profile routing (/{vendor_id})
  - [ ] Build item feed with connection prioritization
  - [ ] Add vendor showcase/portfolio display

- [ ] **Add error handling and user feedback**
  - [ ] Implement comprehensive error boundaries
  - [ ] Consistent error styling
    - [ ] Use error color scheme rather than hardcoded red color scheme
    - [ ] Shared components for error alerts
      - [ ] Login form
      - [ ] Invite manager
      - [ ] Where else?
  - [ ] Add loading states and progress indicators
  - [ ] Create user-friendly error messages
  - [ ] Add form validation feedback

- [ ] **Content policy violations**
  - [ ] Implement simple method for authenticated users to anonymously mark concerns about content policy violations
  - [ ] Email system admin when items are marked as concerning

### Testing & Quality

- [ ] **Add comprehensive test coverage**
  - [ ] Write unit tests for utilities and components
  - [ ] Create E2E tests for critical user flows
  - [ ] Add authentication flow tests
  - [ ] Test item creation and messaging flows

- [ ] **Security and performance validation**
  - [ ] Verify RLS policies work correctly
  - [ ] Test visibility rules and anonymity
  - [ ] Performance testing for image uploads
  - [ ] Security audit of auth flows

- [ ] **Alpha testing preparation**
  - [ ] Setup monitoring and logging
  - [ ] Create admin tools for user management
  - [ ] Add content moderation basics
  - [ ] Prepare for alpha tester onboarding

### Final Branding & Polish

- [ ] **Logo and icon assets**
  - [ ] Design or commission logo (once final name is determined)
  - [ ] Generate PWA icon files (icon-192.png, icon-512.png)
  - [ ] Create favicon from logo
  - [ ] Update manifest with proper branding
  - [ ] Add logo to navigation/header
